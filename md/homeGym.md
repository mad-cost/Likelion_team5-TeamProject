## ë°°í¬ ê³¼ì • ê°„ëµíˆ ë³´ê¸° ğŸ‘€
* ë°°í¬ ê³¼ì •
  1. ìŠ¤í”„ë§ë¶€íŠ¸ í”„ë¡œì íŠ¸ì—ì„œ jaríŒŒì¼ì„ ìƒì„± (ë¹Œë“œí•˜ê¸°)
  2. ìƒì„±í•œ jaríŒŒì¼ì„ ë„ì»¤ ì´ë¯¸ì§€ íŒŒì¼ë¡œ ë§Œë“  í›„ ë„ì»¤ í—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— pushí•´ì¤€ë‹¤.
  3. EC2ì—ì„œ ë„ì»¤ í—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ë¥¼ í†µí•´ ì´ë¯¸ì§€ íŒŒì¼ì„ pullë°›ê³ 
  4. pullë°›ì€ ì´ë¯¸ì§€ íŒŒì¼ì„ ëª…ë ¹ì–´ë¥¼ í†µí•´ ì»¨í…Œì´ë„ˆë¡œ ì‹¤í–‰í•œë‹¤.
     ![ë°°í¬ ê³¼ì •](/img/num6.png)
<hr>

* Dockerfile ìƒì„±í•˜ê¸°
  1. main(Master) ë¸Œëœì¹˜ë¡œ ì´ë™
  2. Dockerfile ìƒì„±
        ![Dockerfile ìƒì„±](/img/num13.png)
  3. ëª…ë ¹ì–´ë¥¼ í†µí•´ì„œ jaríŒŒì¼ ë§Œë“¤ì–´ì£¼ê¸°
    > ./gradlew bootJar  

<hr>

* Docker ì„¤ì¹˜ <br>
  * `ë¡œì»¬ ì»´í“¨í„°`ì™€ `EC2` ê°ê°ì— ë„ì»¤ë¥¼ ì„¤ì¹˜í•´ ì¤˜ì•¼ í•œë‹¤
  >ìš°ë¶„íˆ¬ì—ì„œ ë„ì»¤ ì„¤ì¹˜í•˜ê¸°
  >> * ì—…ë°ì´íŠ¸ <br>
  >> sudo apt-get update -y  <br>
  >> * HTTP íŒ¨í‚¤ì§€ ì„¤ì¹˜  <br>
  >> sudo apt install apt-transport-https ca-certificates curl software-properties-common  <br>
  >> * docker repository ì ‘ê·¼ì„ ìœ„í•œ gpg í‚¤ ì„¤ì •  <br>
  >> curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -  <br>
  >> * docker repository ë“±ë¡  <br>
  >> sudo add-apt-repository "deb [arch=amd64] https://download.docker.com/linux/ubuntu focal stable"  <br>
  >> * ë‹¤ì‹œ ì—…ë°ì´íŠ¸  <br>
  >> sudo apt update  <br>
  >> * Docker ì—”ì§„ ì„¤ì¹˜  <br>
  >> sudo apt install docker-ce  <br>
<hr>

* Docker Hub
  * https://hub.docker.com ì—ì„œ ë¡œê·¸ì¸ í›„ ë¦¬í¬ì§€í† ë¦¬ ìƒì„±í•˜ê¸°
  1. ë„ì»¤ ì´ë¯¸ì§€ë¥¼ ì¤‘ì•™ì—ì„œ ê´€ë¦¬í•˜ê³  ë°°í¬í•˜ê¸° ìœ„í•œ í”Œë«í¼
  2. Docker Hubë¥¼ í†µí•´ ì´ë¯¸ì§€ë¥¼ pushí•˜ê³  pullí•´ì¤€ë‹¤

<hr>

* Docker Image <br> 
  * ë„ì»¤ ì´ë¯¸ì§€ ë§Œë“œëŠ” ëª…ë ¹ì–´
    > docker build -t [ë„ì»¤ì•„ì´ë””/ë¦¬í¬ì§€í† ë¦¬ì´ë¦„] <br>
     ex) docker build -t dockerjun123/homegym .
  * ìƒì„±ëœ ì´ë¯¸ì§€ í™•ì¸   
    > docker images
<hr>

* Docker Hubì— Pushí•˜ê¸°
  * ë„ì»¤ ë¡œê·¸ì¸ í•´ì£¼ê¸°
    > docker login
  * ì´ë¯¸ì§€ë¥¼ ë„ì»¤ í—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— push
    > docker push dockerjun123/homegym

    ![ë„ì»¤ í—ˆë¸Œ](/img/num5.png)
<hr>

* EC2ì—ì„œ ì´ë¯¸ì§€ pull ë°›ê¸° <br>
  * EC2 ipì— ì ‘ì†í•˜ê¸°
    > ssh -i {í‚¤í˜ì–´ ì´ë¦„} ubuntu@<í¼ë¸”ë¦­IPv4> <br>
    > ex) ssh -i aws_homeGym.pem ubuntu@3.34.195.158 <br>
  * [ì°¸ê³ ] NCPì—ì„œ SSHì ‘ì† ë°©ë²• <br>
    > ssh root@{ì„œë²„ ì ‘ì†ìš© ê³µì¸ IP} -p <ì™¸ë¶€ í¬íŠ¸> <br>
    > ex) ssh root@106.10.43.168 -p 1024
  
  * ë„ì»¤ í—ˆë¸Œ ë¦¬í¬ì§€í† ë¦¬ì— ìˆëŠ” ì´ë¯¸ì§€ pullë°›ê¸°
    > docker pull dockerjun123/homegym
  * ìƒì„±ëœ ì´ë¯¸ì§€ë¡œ ì»¨í…Œì´ë„ˆ ì‹¤í–‰
    > docker run -d -p 8080:8080 dockerjun123/homegym
  * ì‹¤í–‰ ì¤‘ì¸ ì»¨í…Œì´ë„ˆ í™•ì¸í•´ë³´ê¸°
    * `mysql`ê³¼ `redis`ë„ í•¨ê»˜ ì‹¤í–‰ ì¤‘ì¸ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤ <br>
      > docker ps

      ![ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ](/img/num14.png)
<hr>

* Nginx ì„¤ì¹˜ ë° ë³´ì•ˆ ê·¸ë£¹ ì„¤ì •
  * ë™ì‹œ ì ‘ì† ì²˜ë¦¬ì— íŠ¹í™”ëœ ì›¹ì„œë²„
  * í´ë¼ì´ì–¸íŠ¸ë¡œë¶€í„° HTTPìš”ì²­ì„ ë°›ì•„ ì„œë²„ë¡œ ìš”ì²­ì„ ì „ë‹¬í•œë‹¤
  * Nginx ì„¤ì¹˜
    > * nginxì„œë²„ í”„ë¡œê·¸ë¨ ì„¤ì¹˜ <br>
    sudo apt-get install nginx <br>
    >* nginx ì‹¤í–‰ <br>
    sudo systemctl start nginx <br>
  * nginx ì‹¤í–‰ í™•ì¸ <br>
    * [ì°¸ê³ ] Nginxì˜ ê¸°ë³¸ í¬íŠ¸ëŠ” 80ë²ˆì´ë‹¤
    * activeê°€ ë…¹ìƒ‰ìœ¼ë¡œ ëœ¨ë©´, nginxì‹¤í–‰ ì„±ê³µ <br>
      > sudo systemctl status nginx <br>
  
    ![Nginx](/img/num15.png)
    
  * ì£¼ì†Œì°½ì— ip ì£¼ì†Œë¥¼ ë„£ìœ¼ë©´ Nginxì˜ ì²« í˜ì´ì§€ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤ <br>
  ![Nginx](/img/num16.png)
  
* ### HTTPìš”ì²­ì„ ì„œë²„ë¡œ ì „ë‹¬í•˜ê¸°
###### Nginx ì„¤ì •
```java
  server {
    listen 80;
    server_name <ì„œë²„ ip ì£¼ì†Œ>;

    location = /favicon.ico { access_log off; log_not_found off; }

    location / {
        include proxy_params;
        proxy_pass http://localhost:8080;
    }

  }
```
  1. `<ì„œë²„ ip ì£¼ì†Œ>` ë¡œ ë³´ë‚´ì§€ëŠ” HTTP ìš”ì²­ì„ ì»´í“¨í„° ë‚´ì˜ `8080` í¬íŠ¸ë¡œ ì „ë‹¬í•˜ëŠ” ì„¤ì • íŒŒì¼ì´ë‹¤
  2. ì—¬ê¸°ì˜ <ì„œë²„ ip ì£¼ì†Œ> ë¥¼ ì¸ìŠ¤í„´ìŠ¤ì˜ IP ì£¼ì†Œë¡œ ë³€ê²½í•˜ê³ , `/etc/nginx/sites-enabled/` í´ë”ì— ë„£ì–´ì¤€ë‹¤
  3. ì•„ë˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ í•´ë‹¹ í´ë”ë¡œ ì´ë™ <br>
  > cd /etc/nginx/sites-enabled/
  4. `vi` ëª…ë ¹ì„ ì´ìš©í•˜ë©´ íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤
  > sudo vi spring_boot
  5. Nginx ì„¤ì •íŒŒì¼ì„ ë¶™ì—¬ë„£ê³  `:wq`ë¡œ ì €ì¥í•´ì£¼ê¸°
  6. systemctlì„ ì´ìš©í•´ Nginxë¥¼ ì¬ì‹œì‘í•˜ê¸°.
  > sudo systemctl restart nginx.service
  7. ì´í›„ ì£¼ì†Œì°½ì— `:8080 ì„ ì œì™¸`í•˜ê³  IP ì£¼ì†Œë¥¼ ì…ë ¥í•˜ë©´ ëœë‹¤
<hr>

* Gabia ë„ë©”ì¸ ì—°ê²° https://www.gabia.com
  * ì»´í“¨í„°ì˜ IPì£¼ì†ŒëŠ” ì¸ê°„ ì¹œí™”ì ì´ì§€ ì•Šìœ¼ë¯€ë¡œ, ì¸ê°„ ì¹œí™”ì ì¸ DNSì£¼ì†Œë¥¼ ì´ìš©í•œë‹¤
    ![ê°€ë¹„ì•„](/img/num8.png)
  1. `Myê°€ë¹„ì•„`í˜ì´ì§€ë¡œ ì´ë™
  2. DNS ê´€ë¦¬íˆ´ì—ì„œ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” ë„ë©”ì¸ ì„¤ì •ìœ¼ë¡œ ì´ë™
  3. `ë ˆì½”ë“œ ìˆ˜ì •`ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ë ˆì½”ë“œ ì¶”ê°€
  4. ë„ë©”ì¸ì´ ì‹¤ì œë¡œ ì–´ë–¤ IPì£¼ì†Œë¥¼ ë‚˜íƒ€ë‚´ëŠ”ì§€ë¥¼ ì•Œë ¤ì£¼ëŠ” `Aíƒ€ì… ë ˆì½”ë“œ`ì™€, <br>
  ë‹¤ë¥¸ ë„ë©”ì¸ê³¼ ë™ì¼í•œ ë„ë©”ì¸ì„ì„ ë‚˜íƒ€ë‚´ëŠ” `CNAMEíƒ€ì… ë ˆì½”ë“œ`ë¥¼ `ì¶”ê°€`í•´ ì¤€ë‹¤ <br>
     ![ê°€ë¹„ì•„DNS](/img/num17.png)
* Nginx ì¬ì„¤ì •  
  1. ipì£¼ì†Œê°€ ë°”ê¼ˆìœ¼ë¯€ë¡œ `server_name`ë¶€ë¶„ì„ `ê°€ë¹„ì•„ì—ì„œ ì„¤ì •í•œ ë„ë©”ì¸`ìœ¼ë¡œ ë³€ê²½í•´ì¤€ë‹¤ [ì´ë™í•˜ê¸°](#Nginx-ì„¤ì •)
  2. Nginx ì¬ì‹¤í–‰
    > sudo systemctl restart nginx.service

  ![ê°€ë¹„ì•„ ë„ë©”ì¸](/img/num9.png)
<hr>

* HTTPS ì ìš©í•˜ê¸°
  * HTTPSëŠ” HTTP í†µì‹ ì„ í•˜ë˜, TLSë¥¼ ì´ìš©í•´ ê·¸ ë°ì´í„°ë¥¼ ì•”í˜¸í™” í•˜ì—¬ ì£¼ê³ ë°›ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤
  * HTTPS ì ìš©ì´ ëë‚˜ê¸° ì „ì—ëŠ” ì‚¬ìš©ìê°€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì œì¶œí•˜ëŠ” ë“±ì˜ ê¸°ëŠ¥ì€ ê³µê°œì ìœ¼ë¡œ ì œê³µí•˜ì§€ ì•ŠëŠ”ê²ƒì´ ì•ˆì „í•˜ë‹¤
* CerBot
  * ë¬´ë£Œ SSLì¸ì¦ì„œë¥¼ Nginxì— ë°”ë¡œ ì ìš©ì‹œì¼œì£¼ëŠ” Certbot ì´ë¼ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‚¬ìš© 
* Cerbot ì„¤ì¹˜í•˜ê¸°
  * certbotì€ aptê°€ ì•„ë‹Œ `snap`ì´ë¼ëŠ” ë‹¤ë¥¸ ì†Œí”„íŠ¸ì›¨ì–´ ê´€ë¦¬ ë„êµ¬ë¥¼ ì´ìš©í•´ ì„¤ì¹˜ë¥¼ í•œë‹¤
    > * ëª…ë ¹ì–´ ìˆœì„œëŒ€ë¡œ ì…ë ¥í•˜ê¸° <br> 
        sudo snap install core; sudo snap refresh core <br>
        sudo snap install --classic certbot <br>
        sudo ln -s /snap/bin/certbot /usr/bin/certbot # ë°”ë¡œê°€ê¸°ë¥¼ ìƒì„± <br>
  * `--nginx` ì˜µì…˜ê³¼ í•¨ê¹¨ ì‹¤í–‰í•©ë‹ˆë‹¤.
    > sudo certbot --nginx
  * ì´ í›„ ì‚¬ìš©ì ë™ì˜ë¥¼ êµ¬í•˜ëŠ” ê²ƒë“¤
    1. ì´ìš©ì•½ê´€ : `y`
    2. ì •ê¸°ì  ìˆ˜ì‹  ë™ì˜ : `n`
    3. TLSë¥¼ ì ìš©í•  ë„ë©”ì¸ : `1`
      > ex) 1: homegym.site
    4. ###### ì¸ì¦ì„œë¥¼ ë°›ì•„ì™€ì„œ ì ìš©í•˜ëŠ” ê³¼ì •
  
  1. ì‹¤í–‰ì´ ëë‚˜ë©´ ì¼ì‹œì ìœ¼ë¡œ ìì‹ ì˜ ì‚¬ì´íŠ¸ì— ì ‘ì†ì´ ë¶ˆê°€í•´ì§€ëŠ”ë°,
  2. ì´ëŠ” HTTPSê°€ 80ì´ ì•„ë‹Œ 443 í¬íŠ¸ë¡œ ìš”ì²­ì´ ë³´ë‚´ì§€ê¸° ë•Œë¬¸ì´ë‹¤ 
  3. 80 ê³¼ ë§ˆì°¬ê°€ì§€ë¡œ `443ë„ ë³´ì•ˆ ê·œì¹™ì— í¬í•¨`ì‹œì¼œì•¼ í•œë‹¤
  * `EC2 í”„ë¦¬í‹°ì–´ ìš©ëŸ‰ì´ˆê³¼`ë¡œ ì¸í•´ NCP íšŒì›ê°€ì…ì‹œ 10ë§Œì› ë¬´ë£Œ í¬ë ˆë”§ì„ ì´ìš©í•˜ì˜€ë‹¤
     ![NCPì¸ìŠ¤í„´ìŠ¤](/img/num18.png)
  * ì‹¤í–‰ì´ ëë‚˜ë©´ ë¸Œë¼ìš°ì €ë¡œ ì ‘ì†í•´ HTTPSê°€ ì ìš©ëœ ìƒíƒœë¥¼ í™•ì¸ ê°€ëŠ¥í•˜ë‹¤.
    ![CerBotì ìš©](/img/num10.png)
  <hr>
  
  ### ë°°í¬ ì„±ê³µ!! ğŸ™†
  ![CerBotì ìš©](/img/num12.png) 
  ![CerBotì ìš©](/img/num7.png)
